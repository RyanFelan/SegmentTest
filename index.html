<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Test Site</title>
    <script>
      function getCookie(name) {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.startsWith(name + '=')) {
            return cookie.substring(name.length + 1);
          }
        }
        return null;
      }

      function waitForOptimizelyUserId() {
        const checkUserIdInterval = setInterval(() => {
          const optimizelyUserId = getCookie('optimizelyEndUserId');
          if (optimizelyUserId) {
            console.log('Optimizely User ID found:', optimizelyUserId);
            clearInterval(checkUserIdInterval);

            // Dynamically insert the iframe after the cookie is found
            const iframe = document.createElement('iframe');
            iframe.src = 'https://my-next-js-demo-jade.vercel.app/webx';
            iframe.width = '600';
            iframe.height = '400';
            iframe.onload = function() {
              console.log('Iframe loaded, sending message...');
              iframe.contentWindow.postMessage({
                cookieName: 'optimizelyEndUserId',
                cookieValue: optimizelyUserId
              }, 'https://my-next-js-demo-jade.vercel.app');
            };
            document.body.appendChild(iframe);
          } else {
            console.warn('Optimizely User ID not found, retrying...');
          }
        }, 500); // Poll every 500ms
      }

      // Wait for DOM content to load and then check for the Optimizely User ID
      document.addEventListener('DOMContentLoaded', waitForOptimizelyUserId);
    </script>
  </head>
  <body>
    <p id="cookieValue">Waiting for Optimizely User ID...</p>
  </body>
</html>
