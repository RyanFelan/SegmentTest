<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">

  <title>Test</title>
  <!--Optimizely-->
  <!-- WEB--> <script src="https://cdn.optimizely.com/js/23318520138.js"></script> 
  <!--Optimizely-->
</head>
  <body>
    <h1>Parent Site</h1>
    <p id="cookieValue"></p>

    <script>
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }


        // Get the cookie value for optimizelyEndUserId and display it
        const optimizelyUserId = getCookie('optimizelyEndUserId');
        document.getElementById('cookieValue').innerText = `Optimizely User ID: ${optimizelyUserId}`;

        if (optimizelyUserId) {
          console.log(`Optimizely User ID found: ${optimizelyUserId}`);

          const checkIframe = setInterval(() => {
            const iframe = document.querySelector('iframe[src="https://my-next-js-demo-jade.vercel.app/webx"]');
            console.log("Checking for iframe...", iframe);

            // If the iframe is found and its contentWindow is accessible, post the message
            if (iframe && iframe.contentWindow) {
              console.log("Iframe found, sending message...");

              // Clear the interval once the iframe is found
              clearInterval(checkIframe);

              iframe.onload = function() {
                iframe.contentWindow.postMessage({
                  cookieName: 'optimizelyEndUserId',
                  cookieValue: optimizelyUserId
                }, 'https://my-next-js-demo-jade.vercel.app');
              };
            }
          }, 10);
        }
    </script>
    
    <div>
      <!-- Example of an iframe embedding another website -->
      <iframe src="https://my-next-js-demo-jade.vercel.app/webx" 
          width="100%" 
          height="600px">
           <!-- style="border:none;">-->
      </iframe>
    </div>
  </body>
</html>